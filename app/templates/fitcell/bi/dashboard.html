<!DOCTYPE html>
<html lang="pt-br">

<head>
<meta charset="UTF-8">
<title>Dashboard Fitcell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<link rel="stylesheet" href="{{ url_for('static', filename='paginas3.css') }}">

<style>

body{
background:#eef4fb;
font-family:Inter,system-ui,sans-serif;
}

.page{
max-width:1200px;
margin:auto;
padding:20px;
}

.section-card{
background:#fff;
border-radius:18px;
padding:18px;
box-shadow:0 8px 22px rgba(0,0,0,.08);
}

.kpi-box{
display:flex;
align-items:center;
gap:14px;
}

.kpi-icon{
width:46px;
height:46px;
border-radius:14px;
background:#0d6efd;
color:#fff;
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
}

.kpi-title{
font-size:12px;
color:#64748b;
font-weight:600;
}

.kpi-value{
font-size:22px;
font-weight:800;
color:#0f172a;
}

</style>
</head>

<body>

<div class="page">

<h4 class="mb-3 fw-bold">
<i class="fa-solid fa-chart-column text-primary"></i>
Dashboard Fitcell
</h4>

<!-- FILTROS -->

<form method="GET" class="row g-3 mb-3">

<div class="col-md-3">
<label class="form-label">De</label>
<input type="date" name="data_ini" value="{{ data_ini }}" class="form-control">
</div>

<div class="col-md-3">
<label class="form-label">Até</label>
<input type="date" name="data_fim" value="{{ data_fim }}" class="form-control">
</div>

<div class="col-md-2 d-flex align-items-end">
<button class="btn btn-primary w-100">Aplicar</button>
</div>

<div class="col-md-2 d-flex align-items-end">
<a href="{{ url_for('routes.home') }}" class="btn btn-secondary w-100">
Voltar
</a>
</div>

<div class="col-md-2 d-flex align-items-end">
<a href="{{ url_for('routes.fitcell_bi_dashboard') }}" class="btn btn-outline-secondary w-100">
<i class="fa-solid fa-rotate"></i>
</a>
</div>

</form>

<!-- KPIs -->

<div class="row g-3 mb-4">

<div class="col-md-3 col-6">
<div class="section-card">
<div class="kpi-box">
<div class="kpi-icon">
<i class="fa-solid fa-cart-shopping"></i>
</div>
<div>
<div class="kpi-title">Qtd Vendida</div>
<div id="kpi-qtd-vendida" class="kpi-value">—</div>
</div>
</div>
</div>
</div>

<div class="col-md-3 col-6">
<div class="section-card">
<div class="kpi-box">
<div class="kpi-icon">
<i class="fa-solid fa-dollar-sign"></i>
</div>
<div>
<div class="kpi-title">Valor Vendido</div>
<div id="kpi-valor-vendido" class="kpi-value">—</div>
</div>
</div>
</div>
</div>

<div class="col-md-3 col-6">
<div class="section-card">
<div class="kpi-box">
<div class="kpi-icon">
<i class="fa-solid fa-boxes-stacked"></i>
</div>
<div>
<div class="kpi-title">Qtd Estoque</div>
<div id="kpi-qtd-estoque" class="kpi-value">—</div>
</div>
</div>
</div>
</div>

<div class="col-md-3 col-6">
<div class="section-card">
<div class="kpi-box">
<div class="kpi-icon">
<i class="fa-solid fa-warehouse"></i>
</div>
<div>
<div class="kpi-title">Valor Estoque</div>
<div id="kpi-valor-estoque" class="kpi-value">—</div>
</div>
</div>
</div>
</div>

</div>

<!-- GRÁFICOS -->

<div class="row g-4">

<div class="col-md-6">
<div class="section-card">
<h6 class="mb-3">Vendido por dia</h6>
<canvas id="chartVendidoDia"></canvas>
</div>
</div>

<div class="col-md-6">
<div class="section-card">
<h6 class="mb-3">Top 5 peças vendidas</h6>
<canvas id="chartTopPecas"></canvas>
</div>
</div>

</div>

</div>

<script>
const params = new URLSearchParams(window.location.search).toString();

fetch(`/fitcell/bi/kpis?${params}`)
.then(r=>r.json())
.then(d=>{
document.getElementById("kpi-qtd-vendida").innerText=d.qtd_vendida;
document.getElementById("kpi-valor-vendido").innerText=d.valor_vendido;
document.getElementById("kpi-qtd-estoque").innerText=d.qtd_estoque;
document.getElementById("kpi-valor-estoque").innerText=d.valor_estoque;
});

fetch(`/fitcell/bi/vendido-por-dia?${params}`)
.then(r=>r.json())
.then(rows=>{
new Chart(document.getElementById("chartVendidoDia"),{
type:"line",
data:{
labels:rows.map(r=>r.dia),
datasets:[{
data:rows.map(r=>r.total),
borderColor:"#0d6efd",
backgroundColor:"rgba(13,110,253,.15)",
tension:.3,
fill:true
}]
},
options:{plugins:{legend:{display:false}}}
});
});

fetch(`/fitcell/bi/top-pecas?${params}`)
.then(r=>r.json())
.then(rows=>{
new Chart(document.getElementById("chartTopPecas"),{
type:"bar",
data:{
labels:rows.map(r=>r.codigo),
datasets:[{
data:rows.map(r=>r.quantidade),
backgroundColor:"#0d6efd",
borderRadius:6
}]
},
options:{indexAxis:"y",plugins:{legend:{display:false}}}
});
});
</script>

</body>
</html>
