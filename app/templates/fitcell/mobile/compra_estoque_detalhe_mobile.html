<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Compra #{{ compra.id }}</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<link rel="stylesheet" href="{{ url_for('static', filename='paginas3.css') }}">

<style>
body{background:#eef4fb;}
.mobile-container{padding:12px;max-width:540px;margin:auto;}
.section-card{background:#fff;border-radius:16px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,.08);margin-bottom:12px;}
</style>
</head>

<body>

<div class="mobile-container">

<div class="d-flex justify-content-between align-items-center mb-3">
<strong style="font-size:18px">Compra #{{ compra.id }}</strong>

<a href="{{ url_for('routes.fitcell_listar_compras_estoque_mobile') }}"
class="btn btn-secondary btn-sm">Voltar</a>
</div>

<div class="section-card">

<div class="fw-semibold text-primary">{{ compra.fornecedor.nome }}</div>
<small class="text-muted">
{{ compra.criado_em | utc_to_br | br_data_hora }}
</small>

<div class="mt-2">
{% if compra.status == "ESTORNADA" %}
<span class="badge bg-danger">Estornada</span>
{% else %}
<span class="badge bg-success">Ativa</span>
{% endif %}
</div>

</div>
{% if compra.status != "ESTORNADA" %}
<form method="POST"
action="{{ url_for('routes.fitcell_estornar_compra_estoque_mobile', compra_id=compra.id) }}"
onsubmit="return confirm('Deseja realmente estornar esta compra?')">

<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

<button class="btn btn-danger w-100 mt-2">
<i class="fa fa-rotate-left"></i> Estornar Compra
</button>

</form>
{% endif %}
<hr>

{% for i in itens %}

<div class="section-card">

<div class="fw-semibold">{{ i.peca.nome }}</div>

<small class="text-muted">{{ i.peca.codigo_interno }}</small>

<div class="mt-1 small">
Qtd: {{ i.quantidade }} Ã— R$ {{ "%.2f"|format(i.custo_unitario) }}
</div>

<div class="fw-semibold mt-1">
Total: R$ {{ "%.2f"|format((i.quantidade or 0) * (i.custo_unitario or 0)) }}
</div>

</div>

{% endfor %}

<div class="section-card text-end">

<strong>Total da Compra:</strong><br>
<h5 class="text-primary">R$ {{ "%.2f"|format(total_compra) }}</h5>

</div>

</div>

</body>
</html>
